<h2>
  Acoustic Event Summary Report

  <a id="print-button" class="ms-3" (click)="printPage()">
    <fa-icon [icon]="['fas', 'print']"></fa-icon>
  </a>
</h2>

<section class="border-bottom border-top">
  <h3>Search Parameters</h3>

  <div class="generatedByLabel fst-italic">
    Generated by {{ currentUser.userName }}
    {{ report.generatedDate ?? DateTime.now() | date }}
  </div>

  <div class="associatedFiles fst-italic my-2">
    Associated file:
    <a
      name="downloadEventsLink"
      class="link-primary"
      href="{{ eventDownloadUrl }}"
    >
      Sites.dawnxmonth.csv
    </a>
  </div>

  <div class="reportInformation container">
    <div class="row py-2">
      <div class="col fw-bold">Sites</div>

      <div class="col">Dalby, St George Narrabri</div>

      <div class="col fw-bold">Points</div>

      <div class="col">Wet A, B; Dry A, B</div>
    </div>

    <div class="row py-2">
      <div class="col fw-bold">Times</div>

      <div
        *ngIf="
          parameterDataModel.timeStartedAfter ||
          parameterDataModel.timeFinishedBefore
        "
        class="col"
      >
        {{ parameterDataModel.timeStartedAfter | time }} –
        {{ parameterDataModel.timeFinishedBefore | time }}
      </div>

      <div
        *ngIf="
          !parameterDataModel.timeStartedAfter &&
          !parameterDataModel.timeFinishedBefore
        "
        class="col"
      >
        (not specified)
      </div>

      <div class="col fw-bold">Date Range</div>

      <div
        *ngIf="
          parameterDataModel.dateStartedAfter ||
          parameterDataModel.dateFinishedBefore
        "
        class="col"
      >
        {{ parameterDataModel.dateStartedAfter?.toJSDate() | date }} –
        {{ parameterDataModel.dateFinishedBefore?.toJSDate() | date }}
      </div>

      <div
        *ngIf="
          !parameterDataModel.dateStartedAfter &&
          !parameterDataModel.dateFinishedBefore
        "
        class="col"
      >
        (not specified)
      </div>
    </div>

    <div class="row py-2">
      <div class="col fw-bold">Duration</div>

      <div class="col">{{ parameterDataModel.bucketSize }}</div>

      <div class="col fw-bold">Recognisers</div>

      <div class="col">
        <span *ngFor="let item of report.eventGroups">
          {{ item.provenanceId }}
        </span>
      </div>
    </div>

    <div class="row py-2">
      <div class="col fw-bold">Score Cutoff</div>

      <div class="col">
        {{
          parameterDataModel.score ??
            ViewEventReportComponent.defaultFilterText()
        }}
      </div>

      <div class="col"></div>

      <div class="col"></div>
    </div>
  </div>
</section>

<section class="border-bottom">
  <h3>Summary</h3>

  <div class="reportOverview">
    <div class="alert alert-warning p-3 my-3">
      General warning about different recognisers, 'interpret with cation and
      validate' etc; qualifiers about performance in different regions, etc
    </div>

    <div class="container">
      <div class="row">
        <div class="col">
          <div class="speciesList">
            <!-- TODO: Fetching these values. This will most likely require a 3rd party API -->
            <h4 class="py-1">Native Species: 5</h4>
            <h4 class="py-1">Non-native: 3</h4>
            <h4 class="py-1">Invasive: 3</h4>
          </div>
        </div>

        <div class="col">
          <div name="siteMap" class="site-map">Site Map</div>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="border-bottom">
  <h3>Events Table</h3>

  <div class="events-table">
    <div class="py-4">
      <b>Total number of {{ parameterDataModel.bucketSize }}s analysed: </b>
      {{ report.statistics?.countOfRecordingsAnalyzed }}
      {{ parameterDataModel.bucketSize }}s <br />
      <strong>
        {{ report.statistics?.audioCoverageOverSpan }} {{ bucketSize }}s
      </strong>
      of recordings were found within the requested
      <strong>
        {{ report.statistics?.totalSearchSpan }} {{ bucketSize }}s
      </strong>
      (see
      <a
        name="downloadEventsLink"
        class="link-primary"
        href="{{ eventDownloadUrl }}"
        >Sites.dawnxmonth.csv</a
      >).
    </div>

    <table class="table">
      <tr class="row">
        <th class="col border py-1 fw-bold">Events</th>
        <th class="col border py-1 fw-bold">Recogniser</th>
        <th class="col border py-1 fw-bold"># Detections</th>
        <th class="col border py-1 fw-bold">
          # Detection {{ parameterDataModel.bucketSize }}s
        </th>
        <th class="col border py-1 fw-bold">
          # {{ parameterDataModel.bucketSize }}s with Rain
        </th>
        <th class="col border py-1 fw-bold border">Confidence Plot</th>
      </tr>

      <ng-container *ngFor="let item of report.eventGroups">
        <tr class="row">
          <td class="col border py-1">{{ item.tagId }}</td>
          <td class="col border py-1">{{ item.provenanceId }}</td>
          <td class="col border py-1">{{ item.detections }}</td>
          <td class="col border py-1">{{ item.bucketsWithDetections }}</td>
          <td class="col border py-1">{{ bucketsWithRain(item) }}</td>
          <td class="col border py-1">
            <baw-chart
              class="embedded-figure"
              [spec]="confidencePlotSchema"
              [data]="item.score.histogram"
              [options]="{ actions: false }"
            ></baw-chart>

            <small class="m-1 text-muted">x̄: {{ item.score.mean }}</small>
            <small class="m-1 text-muted"
              >σ: {{ item.score.standardDeviation }}</small
            >
          </td>
        </tr>
      </ng-container>
    </table>
  </div>
</section>

<section>
  <h3>Graphs</h3>

  <div class="alert alert-info p-3 my-3">
    Some kind of text to put these figures into context.
  </div>

  <section>
    <h4>Map of sensors / points</h4>
    <div class="large-embedded-figure p-1">Site Map</div>
  </section>

  <section *ngIf="report.graphs?.accumulationData">
    <h4>Species Accumulation Curve</h4>
    <baw-chart
      class="large-embedded-figure"
      [spec]="speciesAccumulationCurveSchema"
      [data]="report.graphs?.accumulationData"
    ></baw-chart>
  </section>

  <section *ngIf="report.graphs?.speciesCompositionData">
    <h4>Species Composition</h4>
    <baw-chart
      class="large-embedded-figure"
      [spec]="speciesCompositionCurveSchema"
      [data]="report.graphs?.speciesCompositionData"
    ></baw-chart>
  </section>

  <section>
    <h4>False colour spectrogram(s)</h4>
    <div class="large-embedded-figure p-1">False colour spectrogram(s)</div>
  </section>
</section>
