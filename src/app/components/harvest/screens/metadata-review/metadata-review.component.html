<h3>Review</h3>

<p>
  This is a review of the audio data. If you are missing a
  {{ siteColumnLabel }} for one of the folders you have uploaded,
  <a [strongRoute]="newSiteMenuItem.route">create the {{ siteColumnLabel }}</a>
  and refresh this page.
</p>

<p *ngIf="harvest.report.itemsErrored > 0" class="alert alert-danger">
  An unexpected error occurred in
  {{ harvest.report.itemsErrored | number }} file(s). Please contact us so we
  can investigate the issue. You can choose to continue the harvest, but any
  files that produced errors will be ignored.
</p>

<baw-harvest-statistics [statistics]="statistics"></baw-harvest-statistics>

<div class="grid-table mb-3">
  <!-- Headers -->
  <div class="grid-table-header">
    <div class="grid-table-item">Path</div>
    <div class="grid-table-item">{{ siteColumnLabel }}</div>
    <div class="grid-table-item">UTC offset</div>
    <div class="grid-table-item">Recursive</div>
    <div class="grid-table-item"></div>
  </div>

  <!-- Re-use the progress animation from ngx-datatable -->
  <div class="grid-table-header table-progress">
    <div class="wrapper">
      <div *ngIf="tableLoading" class="progress-linear">
        <div class="container">
          <div class="bar"></div>
        </div>
      </div>
    </div>
  </div>

  <!--
    We could use css to determine if the row is even, however this can increase
    repaint times
  -->
  <div
    *ngFor="let row of rows.toArray(); let even = even; trackBy: trackByRow"
    class="grid-table-row"
  >
    <baw-meta-review-folder-row
      *ngIf="isFolder(row)"
      class="display-contents"
      [harvest]="harvest"
      [project]="project"
      [row]="row"
      [ngStyle]="{ backgroundColor: even ? '#f2f2f2' : 'white' }"
      (toggleFolder)="toggleRow(row)"
      (mappingsChange)="updateHarvestWithMappingChange()"
    ></baw-meta-review-folder-row>

    <baw-meta-review-file-row
      *ngIf="isFile(row)"
      class="display-contents"
      [row]="row"
      [ngStyle]="{ backgroundColor: even ? '#f2f2f2' : 'white' }"
    ></baw-meta-review-file-row>

    <baw-meta-review-load-more-row
      *ngIf="isLoadMore(row)"
      class="display-contents"
      [row]="row"
      [ngStyle]="{ backgroundColor: even ? '#f2f2f2' : 'white' }"
      (loadMore)="toggleRow(row)"
    ></baw-meta-review-load-more-row>
  </div>
</div>

<div class="d-flex justify-content-between">
  <button
    class="btn btn-outline-primary"
    [disabled]="transitioningStage"
    (click)="onBackClick()"
  >
    Upload more files
  </button>
  <button
    *ngIf="harvest.isMappingsDirty"
    class="btn btn-primary"
    [disabled]="transitioningStage"
    (click)="onSaveClick()"
  >
    Check changes
  </button>
  <!-- TODO Modal popup when hasUnsavedChanges -->
  <button
    class="btn"
    [class.btn-primary]="!harvest.isMappingsDirty"
    [class.btn-warning]="harvest.isMappingsDirty"
    [disabled]="transitioningStage"
    (click)="onNextClick()"
  >
    {{
      harvest.isMappingsDirty ? "Continue without checking changes" : "Continue"
    }}
  </button>
</div>
