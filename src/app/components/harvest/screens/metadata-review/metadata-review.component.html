<h3>Review</h3>

<p>This is a review of the audio data</p>

<div class="statistics">
  <div class="card shadow">
    <div class="card-body">
      <div class="bg-success icon">
        <fa-icon [icon]="['fas', 'folder-tree']" class="text-white"></fa-icon>
      </div>

      <div class="fs-5 font-monospace">
        {{ harvest.report.itemsTotal | number }}
      </div>
      <div class="title fs-6 text-muted">Total Files</div>
    </div>
  </div>

  <div class="card shadow">
    <div
      class="card-body"
      [ngbTooltip]="(harvest.report.itemsSizeBytes | number) + ' bytes'"
    >
      <div class="bg-success icon">
        <fa-icon [icon]="['fas', 'hard-drive']" class="text-white"></fa-icon>
      </div>

      <div class="fs-5 font-monospace">
        {{ harvest.report.itemsSize }}
      </div>
      <div class="title fs-6 text-muted">Total Size</div>
    </div>
  </div>

  <div class="card shadow">
    <div
      class="card-body"
      [ngbTooltip]="(harvest.report.itemsDurationSeconds | number) + ' seconds'"
    >
      <div class="bg-success icon">
        <fa-icon [icon]="['fas', 'clock']" class="text-white"></fa-icon>
      </div>

      <div class="fs-5 font-monospace">
        {{ humanizeDuration(harvest.report.itemsDuration) }}
      </div>
      <div class="title fs-6 text-muted">Total Duration</div>
    </div>
  </div>

  <div class="card shadow">
    <div class="card-body">
      <div class="bg-warning icon">
        <fa-icon
          class="text-black"
          [icon]="['fas', 'triangle-exclamation']"
        ></fa-icon>
      </div>

      <div class="fs-5 font-monospace">
        {{ harvest.report.itemsInvalidFixable | number }}
      </div>
      <div class="title fs-6 text-muted">Need Attention</div>
    </div>

    <div class="card-body">
      <div class="bg-danger icon">
        <fa-icon [icon]="['fas', 'xmark']" class="text-white"></fa-icon>
      </div>

      <div class="fs-5 font-monospace">
        {{ harvest.report.itemsInvalidNotFixable | number }}
      </div>
      <div class="title fs-6 text-muted">Problems</div>
    </div>
  </div>
</div>

<!-- Should use harvest items list instead of harvest mappings. This allows for us to open sub-directories, etc -->
<ngx-datatable
  class="mb-3"
  bawDatatableDefaults
  [rows]="mappings"
  [externalPaging]="false"
  [externalSorting]="false"
>
  <ngx-datatable-column prop="path">
    <ng-template let-value="value" ngx-datatable-cell-template>
      {{ value }}
    </ng-template>
  </ngx-datatable-column>
  <!-- Enable overflow so that typeahead options will show -->
  <ngx-datatable-column
    prop="siteId"
    cellClass="overflow-visible"
    [width]="300"
    [maxWidth]="300"
  >
    <ng-template let-column="column" ngx-datatable-header-template>
      {{ siteColumnLabel }}
    </ng-template>
    <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
      <baw-loading
        *ngIf="row.site | isUnresolved; else siteSelector"
        size="sm"
      ></baw-loading>

      <ng-template #siteSelector>
        <baw-harvest-site-selector
          [project]="project"
          [site]="row.site"
          (siteIdChange)="setSite(row, $event)"
        ></baw-harvest-site-selector>
      </ng-template>
    </ng-template>
  </ngx-datatable-column>
  <ngx-datatable-column prop="utcOffset" [width]="200" [maxWidth]="200">
    <ng-template let-column="column" ngx-datatable-header-template>
      UTC Offset
    </ng-template>
    <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
      <baw-harvest-utc-offset-selector
        [offset]="value"
        (offsetChange)="setOffset(row, $event)"
      ></baw-harvest-utc-offset-selector>
    </ng-template>
  </ngx-datatable-column>
</ngx-datatable>

<div class="d-flex justify-content-between">
  <button
    class="btn btn-outline-primary"
    [disabled]="loading"
    (click)="onBackClick()"
  >
    Upload more files
  </button>
  <button
    *ngIf="harvest.isMappingsDirty"
    class="btn btn-primary"
    [disabled]="loading"
    (click)="onSaveClick()"
  >
    Check changes
  </button>
  <!-- Redirect to metadata extraction instead of next step if changes made -->
  <!-- TODO Modal popup when hasUnsavedChanges -->
  <button
    class="btn"
    [class.btn-primary]="!harvest.isMappingsDirty"
    [class.btn-warning]="harvest.isMappingsDirty"
    [disabled]="loading"
    (click)="onNextClick()"
  >
    {{
      harvest.isMappingsDirty ? "Continue without checking changes" : "Continue"
    }}
  </button>
</div>
