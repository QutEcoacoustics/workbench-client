<h2>Recent Annotations</h2>

<ngx-datatable
  bawDatatableDefaults
  [externalPaging]="false"
  [externalSorting]="false"
  [footerHeight]="0"
  [rows]="rows()"
  [columns]="columns"
>
  <!-- Site name (logged in only) -->
  @if (session.isLoggedIn) {
    <ngx-datatable-column name="Site" [sortable]="false">
      <ng-template let-column="column" ngx-datatable-header-template>
        <fa-icon class="me-2" [icon]="['fas', 'map-marker-alt']" />
        Site
      </ng-template>

      <ng-template let-value="value" ngx-datatable-cell-template>
        @if (
          (value.audioRecording | isUnresolved) ||
          (value.audioRecording?.site | isUnresolved)
        ) {
          <baw-loading size="sm" />
        } @else {
          <span>
            {{ value.audioRecording?.site?.name ?? "Unknown Site" }}
          </span>
        }
      </ng-template>
    </ngx-datatable-column>
  }

  <!-- User name (logged in only) -->
  @if (session.isLoggedIn) {
    <ngx-datatable-column name="User" [sortable]="false">
      <ng-template let-column="column" ngx-datatable-header-template>
        <fa-icon class="me-2" [icon]="['fas', 'user']" />
        User
      </ng-template>

      <ng-template let-value="value" ngx-datatable-cell-template>
        @if (value.creator | isUnresolved) {
          <baw-loading size="sm" />
        } @else {
          <a [bawUrl]="value.creator.viewUrl">
            {{ value.creator.userName }}
          </a>
        }
      </ng-template>
    </ngx-datatable-column>
  }

  <!-- Tags -->
  <ngx-datatable-column name="Tags" [sortable]="false">
    <ng-template let-column="column" ngx-datatable-header-template>
      <fa-icon class="me-2" [icon]="['fas', 'tags']" />
      Tags
    </ng-template>

    <ng-template let-value="value" ngx-datatable-cell-template>
      @for (tag of value.tags; track tag.id) {
        <span class="badge text-bg-highlight me-1">
          {{ tag.text }}
        </span>
      }

      @if (value.tags | isUnresolved) {
        <baw-loading size="sm" />
      } @else {
        @if (value.tags.length === 0) {
          (none)
        }
      }
    </ng-template>
  </ngx-datatable-column>

  <!-- Updated -->
  <ngx-datatable-column name="Updated" [sortable]="false">
    <ng-template let-column="column" ngx-datatable-header-template>
      <fa-icon class="me-2" [icon]="['fas', 'calendar-alt']" />
      Updated
    </ng-template>

    <ng-template let-value="value" ngx-datatable-cell-template>
      <baw-time-since [value]="value" />
    </ng-template>
  </ngx-datatable-column>

  <!-- Actions -->
  <ngx-datatable-column
    name="Model"
    [width]="175"
    [maxWidth]="175"
    [sortable]="false"
  >
    <ng-template let-column="column" ngx-datatable-header-template />
    <ng-template let-value="value" ngx-datatable-cell-template>
      <a
        id="playBtn"
        class="btn btn-sm btn-primary me-2"
        [bawUrl]="value.listenViewUrl"
      >
        Play
      </a>
      <a
        id="annotationBtn"
        class="btn btn-sm btn-secondary"
        [bawUrl]="value.annotationViewUrl"
      >
        Annotation
      </a>
    </ng-template>
  </ngx-datatable-column>
</ngx-datatable>
