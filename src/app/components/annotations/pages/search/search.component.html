<h1>Annotation Search</h1>

<div>
  <baw-annotation-search-form
    #annotationSearchForm
    [searchParameters]="searchParameters"
    (searchParametersChange)="updateSearchParameters($event)"
  />

  <div class="mt-2">
    <!--
      TODO: Once the audio events download route supports url encoded filters
      we should uncomment this buttons functionality
      see: https://github.com/QutEcoacoustics/baw-server/issues/688
    -->
    <!-- <a class="btn btn-secondary me-2" [bawUrl]="downloadAnnotationsUrl()">
      Download Annotations
    </a> -->

    <baw-can [ifLoggedIn]="true">
      <button
        class="verify-button btn btn-primary"
        (click)="createVerificationTask()"
      >
        Verify This List
      </button>
    </baw-can>
  </div>
</div>

<hr />

<div>
  @if (!error) {
    @if (loading) {
      <baw-loading />
    } @else {
      <p>
        Displaying
        <span class="fw-bold">{{ searchResults.length }}</span> of
        <span class="fw-bold">all {{ paginationInformation?.total }}</span>
        audio events.
      </p>

      @if (searchResults.length === 0) {
        <h2 class="no-results-error">No annotations found</h2>
      } @else {
        <div class="annotations-grid my-2">
          @for (verificationModel of searchResults; track verificationModel.id) {
            <baw-annotation-event-card [annotation]="verificationModel" />
          }
        </div>
      }

      @if (displayPagination) {
        <ngb-pagination
          class="d-flex justify-content-center mt-4"
          [collectionSize]="paginationInformation?.total ?? 0"
          [(page)]="page"
        />
      }
    }
  } @else {
    <baw-error-handler [error]="error" />
  }
</div>

<ng-template #broadSearchWarningModal let-warningModal>
  <baw-filters-warning-modal
    [modal]="warningModal"
    [itemCount]="paginationInformation.total"
  />
</ng-template>

<ng-template #verificationFiltersModal let-filtersModal>
  <baw-verification-filters-modal
    [modal]="filtersModal"
    [formValue]="verificationParameters"
  />
</ng-template>
